let daleChallWords = new Set([
    'a',
    'able',
    'aboard',
    'about',
    'above',
    'absent',
    'accept',
    'accident',
    'account',
    'ache',
    'aching',
    'acorn',
    'acre',
    'across',
    'act',
    'acts',
    'add',
    'address',
    'admire',
    'adventure',
    'afar',
    'afraid',
    'after',
    'afternoon',
    'afterward',
    'afterwards',
    'again',
    'against',
    'age',
    'aged',
    'ago',
    'agree',
    'ah',
    'ahead',
    'aid',
    'aim',
    'air',
    'airfield',
    'airplane',
    'airport',
    'airship',
    'airy',
    'alarm',
    'alike',
    'alive',
    'all',
    'alley',
    'alligator',
    'allow',
    'almost',
    'alone',
    'along',
    'aloud',
    'already',
    'also',
    'always',
    'am',
    'america',
    'american',
    'among',
    'amount',
    'an',
    'and',
    'angel',
    'anger',
    'angry',
    'animal',
    'another',
    'answer',
    'ant',
    'any',
    'anybody',
    'anyhow',
    'anyone',
    'anything',
    'anyway',
    'anywhere',
    'apart',
    'apartment',
    'ape',
    'apiece',
    'appear',
    'apple',
    'april',
    'apron',
    'are',
    'aren',
    'arise',
    'arithmetic',
    'arm',
    'armful',
    'army',
    'arose',
    'around',
    'arrange',
    'arrive',
    'arrived',
    'arrow',
    'art',
    'artist',
    'as',
    'ash',
    'ashes',
    'aside',
    'ask',
    'asleep',
    'at',
    'ate',
    'attack',
    'attend',
    'attention',
    'august',
    'aunt',
    'author',
    'auto',
    'automobile',
    'autumn',
    'avenue',
    'awake',
    'awaken',
    'away',
    'awful',
    'awfully',
    'awhile',
    'ax',
    'axe',
    'baa',
    'babe',
    'babies',
    'back',
    'background',
    'backward',
    'backwards',
    'bacon',
    'bad',
    'badge',
    'badly',
    'bag',
    'bake',
    'baker',
    'bakery',
    'baking',
    'ball',
    'balloon',
    'banana',
    'band',
    'bandage',
    'bang',
    'banjo',
    'bank',
    'banker',
    'bar',
    'barber',
    'bare',
    'barefoot',
    'barely',
    'bark',
    'barn',
    'barrel',
    'base',
    'baseball',
    'basement',
    'basket',
    'bat',
    'batch',
    'bath',
    'bathe',
    'bathing',
    'bathroom',
    'bathtub',
    'battle',
    'battleship',
    'bay',
    'be',
    'beach',
    'bead',
    'beam',
    'bean',
    'bear',
    'beard',
    'beast',
    'beat',
    'beating',
    'beautiful',
    'beautify',
    'beauty',
    'became',
    'because',
    'become',
    'becoming',
    'bed',
    'bedbug',
    'bedroom',
    'bedspread',
    'bedtime',
    'bee',
    'beech',
    'beef',
    'beefsteak',
    'beehive',
    'been',
    'beer',
    'beet',
    'before',
    'beg',
    'began',
    'beggar',
    'begged',
    'begin',
    'beginning',
    'begun',
    'behave',
    'behind',
    'being',
    'believe',
    'bell',
    'belong',
    'below',
    'belt',
    'bench',
    'bend',
    'beneath',
    'bent',
    'berries',
    'berry',
    'beside',
    'besides',
    'best',
    'bet',
    'better',
    'between',
    'bib',
    'bible',
    'bicycle',
    'bid',
    'big',
    'bigger',
    'bill',
    'billboard',
    'bin',
    'bind',
    'bird',
    'birth',
    'birthday',
    'biscuit',
    'bit',
    'bite',
    'biting',
    'bitter',
    'black',
    'blackberry',
    'blackbird',
    'blackboard',
    'blackness',
    'blacksmith',
    'blame',
    'blank',
    'blanket',
    'blast',
    'blaze',
    'bleed',
    'bless',
    'blessing',
    'blew',
    'blind',
    'blindfold',
    'blinds',
    'block',
    'blood',
    'bloom',
    'blossom',
    'blot',
    'blow',
    'blue',
    'blueberry',
    'bluebird',
    'blush',
    'board',
    'boast',
    'boat',
    'bob',
    'bobwhite',
    'bodies',
    'body',
    'boil',
    'boiler',
    'bold',
    'bone',
    'bonnet',
    'boo',
    'book',
    'bookcase',
    'bookkeeper',
    'boom',
    'boot',
    'born',
    'borrow',
    'boss',
    'both',
    'bother',
    'bottle',
    'bottom',
    'bought',
    'bounce',
    'bow',
    'bowl',
    'box',
    'boxcar',
    'boxer',
    'boxes',
    'boy',
    'boyhood',
    'bracelet',
    'brain',
    'brake',
    'bran',
    'branch',
    'brass',
    'brave',
    'bread',
    'break',
    'breakfast',
    'breast',
    'breath',
    'breathe',
    'breeze',
    'brick',
    'bride',
    'bridge',
    'bright',
    'brightness',
    'bring',
    'broad',
    'broadcast',
    'broke',
    'broken',
    'brook',
    'broom',
    'brother',
    'brought',
    'brown',
    'brush',
    'bubble',
    'bucket',
    'buckle',
    'bud',
    'buffalo',
    'bug',
    'buggy',
    'build',
    'building',
    'built',
    'bulb',
    'bull',
    'bullet',
    'bum',
    'bumblebee',
    'bump',
    'bun',
    'bunch',
    'bundle',
    'bunny',
    'burn',
    'burst',
    'bury',
    'bus',
    'bush',
    'bushel',
    'business',
    'busy',
    'but',
    'butcher',
    'butt',
    'butter',
    'buttercup',
    'butterfly',
    'buttermilk',
    'butterscotch',
    'button',
    'buttonhole',
    'buy',
    'buzz',
    'by',
    'bye',
    'cab',
    'cabbage',
    'cabin',
    'cabinet',
    'cackle',
    'cage',
    'cake',
    'calendar',
    'calf',
    'call',
    'caller',
    'calling',
    'came',
    'camel',
    'camp',
    'campfire',
    'can',
    'canal',
    'canary',
    'candle',
    'candlestick',
    'candy',
    'cane',
    'cannon',
    'cannot',
    'canoe',
    'canyon',
    'cap',
    'cape',
    'capital',
    'captain',
    'car',
    'card',
    'cardboard',
    'care',
    'careful',
    'careless',
    'carelessness',
    'carload',
    'carpenter',
    'carpet',
    'carriage',
    'carrot',
    'carry',
    'cart',
    'carve',
    'case',
    'cash',
    'cashier',
    'castle',
    'cat',
    'catbird',
    'catch',
    'catcher',
    'caterpillar',
    'catfish',
    'catsup',
    'cattle',
    'caught',
    'cause',
    'cave',
    'ceiling',
    'cell',
    'cellar',
    'cent',
    'center',
    'cereal',
    'certain',
    'certainly',
    'chain',
    'chair',
    'chalk',
    'champion',
    'chance',
    'change',
    'chap',
    'charge',
    'charm',
    'chart',
    'chase',
    'chatter',
    'cheap',
    'cheat',
    'check',
    'checkers',
    'cheek',
    'cheer',
    'cheese',
    'cherry',
    'chest',
    'chew',
    'chick',
    'chicken',
    'chief',
    'child',
    'childhood',
    'children',
    'chill',
    'chilly',
    'chimney',
    'chin',
    'china',
    'chip',
    'chipmunk',
    'chocolate',
    'choice',
    'choose',
    'chop',
    'chorus',
    'chose',
    'chosen',
    'christen',
    'christmas',
    'church',
    'churn',
    'cigarette',
    'circle',
    'circus',
    'citizen',
    'city',
    'clang',
    'clap',
    'class',
    'classmate',
    'classroom',
    'claw',
    'clay',
    'clean',
    'cleaner',
    'clear',
    'clerk',
    'clever',
    'click',
    'cliff',
    'climb',
    'clip',
    'cloak',
    'clock',
    'close',
    'closet',
    'cloth',
    'clothes',
    'clothing',
    'cloud',
    'cloudy',
    'clover',
    'clown',
    'club',
    'cluck',
    'clump',
    'coach',
    'coal',
    'coast',
    'coat',
    'cob',
    'cobbler',
    'cocoa',
    'coconut',
    'cocoon',
    'cod',
    'codfish',
    'coffee',
    'coffeepot',
    'coin',
    'cold',
    'collar',
    'college',
    'color',
    'colored',
    'colt',
    'column',
    'comb',
    'come',
    'comfort',
    'comic',
    'coming',
    'company',
    'compare',
    'conductor',
    'cone',
    'connect',
    'coo',
    'cook',
    'cooked',
    'cookie',
    'cookies',
    'cooking',
    'cool',
    'cooler',
    'coop',
    'copper',
    'copy',
    'cord',
    'cork',
    'corn',
    'corner',
    'correct',
    'cost',
    'cot',
    'cottage',
    'cotton',
    'couch',
    'cough',
    'could',
    'couldn',
    'count',
    'counter',
    'country',
    'county',
    'course',
    'court',
    'cousin',
    'cover',
    'cow',
    'coward',
    'cowardly',
    'cowboy',
    'cozy',
    'crab',
    'crack',
    'cracker',
    'cradle',
    'cramps',
    'cranberry',
    'crank',
    'cranky',
    'crash',
    'crawl',
    'crazy',
    'cream',
    'creamy',
    'creek',
    'creep',
    'crept',
    'cried',
    'cries',
    'croak',
    'crook',
    'crooked',
    'crop',
    'cross',
    'crossing',
    'crow',
    'crowd',
    'crowded',
    'crown',
    'cruel',
    'crumb',
    'crumble',
    'crush',
    'crust',
    'cry',
    'cub',
    'cuff',
    'cup',
    'cupboard',
    'cupful',
    'cure',
    'curl',
    'curly',
    'curtain',
    'curve',
    'cushion',
    'custard',
    'customer',
    'cut',
    'cute',
    'cutting',
    'd',
    'dab',
    'dad',
    'daddy',
    'daily',
    'dairy',
    'daisy',
    'dam',
    'damage',
    'dame',
    'damp',
    'dance',
    'dancer',
    'dancing',
    'dandy',
    'danger',
    'dangerous',
    'dare',
    'dark',
    'darkness',
    'darling',
    'darn',
    'dart',
    'dash',
    'date',
    'daughter',
    'dawn',
    'day',
    'daybreak',
    'daytime',
    'dead',
    'deaf',
    'deal',
    'dear',
    'death',
    'december',
    'decide',
    'deck',
    'deed',
    'deep',
    'deer',
    'defeat',
    'defend',
    'defense',
    'delight',
    'den',
    'dentist',
    'depend',
    'deposit',
    'describe',
    'desert',
    'deserve',
    'desire',
    'desk',
    'destroy',
    'devil',
    'dew',
    'diamond',
    'did',
    'didn',
    'die',
    'died',
    'dies',
    'difference',
    'different',
    'dig',
    'dim',
    'dime',
    'dine',
    'ding',
    'dinner',
    'dip',
    'direct',
    'direction',
    'dirt',
    'dirty',
    'discover',
    'dish',
    'dislike',
    'dismiss',
    'ditch',
    'dive',
    'diver',
    'divide',
    'do',
    'dock',
    'doctor',
    'does',
    'doesn',
    'dog',
    'doll',
    'dollar',
    'dolly',
    'don',
    'done',
    'dong',
    'donkey',
    'door',
    'doorbell',
    'doorknob',
    'doorstep',
    'dope',
    'dot',
    'double',
    'dough',
    'dove',
    'down',
    'downstairs',
    'downtown',
    'dozen',
    'drag',
    'drain',
    'drank',
    'draw',
    'drawer',
    'drawing',
    'dream',
    'dress',
    'dresser',
    'dressmaker',
    'drew',
    'dried',
    'drift',
    'drill',
    'drink',
    'drip',
    'drive',
    'driven',
    'driver',
    'drop',
    'drove',
    'drown',
    'drowsy',
    'drub',
    'drum',
    'drunk',
    'dry',
    'duck',
    'due',
    'dug',
    'dull',
    'dumb',
    'dump',
    'during',
    'dust',
    'dusty',
    'duty',
    'dwarf',
    'dwell',
    'dwelt',
    'dying',
    'each',
    'eager',
    'eagle',
    'ear',
    'early',
    'earn',
    'earth',
    'east',
    'eastern',
    'easy',
    'eat',
    'eaten',
    'edge',
    'egg',
    'eh',
    'eight',
    'eighteen',
    'eighth',
    'eighty',
    'either',
    'elbow',
    'elder',
    'eldest',
    'electric',
    'electricity',
    'elephant',
    'eleven',
    'elf',
    'elm',
    'else',
    'elsewhere',
    'empty',
    'end',
    'ending',
    'enemy',
    'engine',
    'engineer',
    'english',
    'enjoy',
    'enough',
    'enter',
    'envelope',
    'equal',
    'erase',
    'eraser',
    'errand',
    'escape',
    'eve',
    'even',
    'evening',
    'ever',
    'every',
    'everybody',
    'everyday',
    'everyone',
    'everything',
    'everywhere',
    'evil',
    'exact',
    'except',
    'exchange',
    'excited',
    'exciting',
    'excuse',
    'exit',
    'expect',
    'explain',
    'extra',
    'eye',
    'eyebrow',
    'eyed',
    'fable',
    'face',
    'facing',
    'fact',
    'factory',
    'fail',
    'faint',
    'fair',
    'fairy',
    'faith',
    'fake',
    'fall',
    'false',
    'family',
    'fan',
    'fancy',
    'far',
    'faraway',
    'fare',
    'farm',
    'farmer',
    'farming',
    'farther',
    'fashion',
    'fashioned',
    'fast',
    'fasten',
    'fat',
    'father',
    'fault',
    'favor',
    'favorite',
    'fear',
    'feast',
    'feather',
    'february',
    'fed',
    'feed',
    'feel',
    'feet',
    'fell',
    'fellow',
    'felt',
    'fence',
    'fever',
    'few',
    'fib',
    'fiddle',
    'field',
    'fife',
    'fifteen',
    'fifth',
    'fifty',
    'fig',
    'fight',
    'figure',
    'file',
    'fill',
    'film',
    'finally',
    'find',
    'fine',
    'finger',
    'finish',
    'fire',
    'firearm',
    'firecracker',
    'fireplace',
    'fireworks',
    'firing',
    'first',
    'fish',
    'fisherman',
    'fist',
    'fit',
    'fits',
    'five',
    'fix',
    'flag',
    'flake',
    'flame',
    'flap',
    'flash',
    'flashlight',
    'flat',
    'flea',
    'flesh',
    'flew',
    'flies',
    'flight',
    'flip',
    'float',
    'flock',
    'flood',
    'floor',
    'flop',
    'flour',
    'flow',
    'flower',
    'flowery',
    'flutter',
    'fly',
    'foam',
    'fog',
    'foggy',
    'fold',
    'folks',
    'follow',
    'following',
    'fond',
    'food',
    'fool',
    'foolish',
    'foot',
    'football',
    'footprint',
    'for',
    'forehead',
    'forest',
    'forget',
    'forgive',
    'forgot',
    'forgotten',
    'fork',
    'form',
    'fort',
    'forth',
    'fortune',
    'forty',
    'forward',
    'fought',
    'found',
    'fountain',
    'four',
    'fourteen',
    'fourth',
    'fox',
    'frame',
    'free',
    'freedom',
    'freeze',
    'freight',
    'french',
    'fresh',
    'fret',
    'friday',
    'fried',
    'friend',
    'friendly',
    'friendship',
    'frighten',
    'frog',
    'from',
    'front',
    'frost',
    'frown',
    'froze',
    'fruit',
    'fry',
    'fudge',
    'fuel',
    'full',
    'fully',
    'fun',
    'funny',
    'fur',
    'furniture',
    'further',
    'fuzzy',
    'gain',
    'gallon',
    'gallop',
    'game',
    'gang',
    'garage',
    'garbage',
    'garden',
    'gas',
    'gasoline',
    'gate',
    'gather',
    'gave',
    'gay',
    'gear',
    'geese',
    'general',
    'gentle',
    'gentleman',
    'gentlemen',
    'geography',
    'get',
    'getting',
    'giant',
    'gift',
    'gingerbread',
    'girl',
    'give',
    'given',
    'giving',
    'glad',
    'gladly',
    'glance',
    'glass',
    'glasses',
    'gleam',
    'glide',
    'glory',
    'glove',
    'glow',
    'glue',
    'go',
    'goal',
    'goat',
    'gobble',
    'god',
    'godmother',
    'goes',
    'going',
    'gold',
    'golden',
    'goldfish',
    'golf',
    'gone',
    'good',
    'goodbye',
    'goodness',
    'goods',
    'goody',
    'goose',
    'gooseberry',
    'got',
    'govern',
    'government',
    'gown',
    'grab',
    'gracious',
    'grade',
    'grain',
    'grand',
    'grandchild',
    'grandchildren',
    'granddaughter',
    'grandfather',
    'grandma',
    'grandmother',
    'grandpa',
    'grandson',
    'grandstand',
    'grape',
    'grapefruit',
    'grapes',
    'grass',
    'grasshopper',
    'grateful',
    'grave',
    'gravel',
    'graveyard',
    'gravy',
    'gray',
    'graze',
    'grease',
    'great',
    'green',
    'greet',
    'grew',
    'grind',
    'groan',
    'grocery',
    'ground',
    'group',
    'grove',
    'grow',
    'guard',
    'guess',
    'guest',
    'guide',
    'gulf',
    'gum',
    'gun',
    'gunpowder',
    'guy',
    'ha',
    'habit',
    'had',
    'hadn',
    'hail',
    'hair',
    'haircut',
    'hairpin',
    'half',
    'hall',
    'halt',
    'ham',
    'hammer',
    'hand',
    'handful',
    'handkerchief',
    'handle',
    'handwriting',
    'hang',
    'happen',
    'happily',
    'happiness',
    'happy',
    'harbor',
    'hard',
    'hardly',
    'hardship',
    'hardware',
    'hare',
    'hark',
    'harm',
    'harness',
    'harp',
    'harvest',
    'has',
    'hasn',
    'haste',
    'hasten',
    'hasty',
    'hat',
    'hatch',
    'hatchet',
    'hate',
    'haul',
    'have',
    'haven',
    'having',
    'hawk',
    'hay',
    'hayfield',
    'haystack',
    'he',
    'head',
    'headache',
    'heal',
    'health',
    'healthy',
    'heap',
    'hear',
    'heard',
    'hearing',
    'heart',
    'heat',
    'heater',
    'heaven',
    'heavy',
    'heel',
    'height',
    'held',
    'hell',
    'hello',
    'helmet',
    'help',
    'helper',
    'helpful',
    'hem',
    'hen',
    'henhouse',
    'her',
    'herd',
    'here',
    'hero',
    'hers',
    'herself',
    'hey',
    'hickory',
    'hid',
    'hidden',
    'hide',
    'high',
    'highway',
    'hill',
    'hillside',
    'hilltop',
    'hilly',
    'him',
    'himself',
    'hind',
    'hint',
    'hip',
    'hire',
    'his',
    'hiss',
    'history',
    'hit',
    'hitch',
    'hive',
    'ho',
    'hoe',
    'hog',
    'hold',
    'holder',
    'hole',
    'holiday',
    'hollow',
    'holy',
    'home',
    'homely',
    'homesick',
    'honest',
    'honey',
    'honeybee',
    'honeymoon',
    'honk',
    'honor',
    'hood',
    'hoof',
    'hook',
    'hoop',
    'hop',
    'hope',
    'hopeful',
    'hopeless',
    'horn',
    'horse',
    'horseback',
    'horseshoe',
    'hose',
    'hospital',
    'host',
    'hot',
    'hotel',
    'hound',
    'hour',
    'house',
    'housetop',
    'housewife',
    'housework',
    'how',
    'however',
    'howl',
    'hug',
    'huge',
    'hum',
    'humble',
    'hump',
    'hundred',
    'hung',
    'hunger',
    'hungry',
    'hunk',
    'hunt',
    'hunter',
    'hurrah',
    'hurried',
    'hurry',
    'hurt',
    'husband',
    'hush',
    'hut',
    'hymn',
    'i',
    'ice',
    'icy',
    'idea',
    'ideal',
    'if',
    'ill',
    'important',
    'impossible',
    'improve',
    'in',
    'inch',
    'inches',
    'income',
    'indeed',
    'indian',
    'indoors',
    'ink',
    'inn',
    'insect',
    'inside',
    'instant',
    'instead',
    'insult',
    'intend',
    'interested',
    'interesting',
    'into',
    'invite',
    'iron',
    'is',
    'island',
    'isn',
    'it',
    'its',
    'itself',
    'ivory',
    'ivy',
    'jacket',
    'jacks',
    'jail',
    'jam',
    'january',
    'jar',
    'jaw',
    'jay',
    'jelly',
    'jellyfish',
    'jerk',
    'jig',
    'job',
    'jockey',
    'join',
    'joke',
    'joking',
    'jolly',
    'journey',
    'joy',
    'joyful',
    'joyous',
    'judge',
    'jug',
    'juice',
    'juicy',
    'july',
    'jump',
    'june',
    'junior',
    'junk',
    'just',
    'keen',
    'keep',
    'kept',
    'kettle',
    'key',
    'kick',
    'kid',
    'kill',
    'killed',
    'kind',
    'kindly',
    'kindness',
    'king',
    'kingdom',
    'kiss',
    'kitchen',
    'kite',
    'kitten',
    'kitty',
    'knee',
    'kneel',
    'knew',
    'knife',
    'knit',
    'knives',
    'knob',
    'knock',
    'knot',
    'know',
    'known',
    'lace',
    'lad',
    'ladder',
    'ladies',
    'lady',
    'laid',
    'lake',
    'lamb',
    'lame',
    'lamp',
    'land',
    'lane',
    'language',
    'lantern',
    'lap',
    'lard',
    'large',
    'lash',
    'lass',
    'last',
    'late',
    'laugh',
    'laundry',
    'law',
    'lawn',
    'lawyer',
    'lay',
    'lazy',
    'lead',
    'leader',
    'leaf',
    'leak',
    'lean',
    'leap',
    'learn',
    'learned',
    'least',
    'leather',
    'leave',
    'leaving',
    'led',
    'left',
    'leg',
    'lemon',
    'lemonade',
    'lend',
    'length',
    'less',
    'lesson',
    'let',
    'letter',
    'letting',
    'lettuce',
    'level',
    'liberty',
    'library',
    'lice',
    'lick',
    'lid',
    'lie',
    'life',
    'lift',
    'light',
    'lightness',
    'lightning',
    'like',
    'likely',
    'liking',
    'lily',
    'limb',
    'lime',
    'limp',
    'line',
    'linen',
    'lion',
    'lip',
    'list',
    'listen',
    'lit',
    'little',
    'live',
    'lively',
    'liver',
    'lives',
    'living',
    'lizard',
    'll',
    'load',
    'loaf',
    'loan',
    'loaves',
    'lock',
    'locomotive',
    'log',
    'lone',
    'lonely',
    'lonesome',
    'long',
    'look',
    'looking',
    'lookout',
    'loop',
    'loose',
    'lord',
    'lose',
    'loser',
    'loss',
    'lost',
    'lot',
    'loud',
    'love',
    'lovely',
    'lover',
    'low',
    'luck',
    'lucky',
    'lumber',
    'lump',
    'lunch',
    'lying',
    'm',
    'ma',
    'machine',
    'machinery',
    'mad',
    'made',
    'magazine',
    'magic',
    'maid',
    'mail',
    'mailbox',
    'mailman',
    'major',
    'make',
    'making',
    'male',
    'mama',
    'mamma',
    'man',
    'manager',
    'mane',
    'manger',
    'many',
    'map',
    'maple',
    'marble',
    'march',
    'mare',
    'mark',
    'market',
    'marriage',
    'married',
    'marry',
    'mask',
    'mast',
    'master',
    'mat',
    'match',
    'matter',
    'mattress',
    'may',
    'maybe',
    'mayor',
    'maypole',
    'me',
    'meadow',
    'meal',
    'mean',
    'means',
    'meant',
    'measure',
    'meat',
    'medicine',
    'meet',
    'meeting',
    'melt',
    'member',
    'men',
    'mend',
    'meow',
    'merry',
    'mess',
    'message',
    'met',
    'metal',
    'mew',
    'mice',
    'middle',
    'midnight',
    'might',
    'mighty',
    'mile',
    'miler',
    'milk',
    'milkman',
    'mill',
    'million',
    'mind',
    'mine',
    'miner',
    'mint',
    'minute',
    'mirror',
    'mischief',
    'miss',
    'misspell',
    'mistake',
    'misty',
    'mitt',
    'mitten',
    'mix',
    'moment',
    'monday',
    'money',
    'monkey',
    'month',
    'moo',
    'moon',
    'moonlight',
    'moose',
    'mop',
    'more',
    'morning',
    'morrow',
    'moss',
    'most',
    'mostly',
    'mother',
    'motor',
    'mount',
    'mountain',
    'mouse',
    'mouth',
    'move',
    'movie',
    'movies',
    'moving',
    'mow',
    'mr',
    'mrs',
    'much',
    'mud',
    'muddy',
    'mug',
    'mule',
    'multiply',
    'murder',
    'music',
    'must',
    'my',
    'myself',
    'nail',
    'name',
    'nap',
    'napkin',
    'narrow',
    'nasty',
    'naughty',
    'navy',
    'near',
    'nearby',
    'nearly',
    'neat',
    'neck',
    'necktie',
    'need',
    'needle',
    'needn',
    'negro',
    'neighbor',
    'neighborhood',
    'neither',
    'nerve',
    'nest',
    'net',
    'never',
    'nevermore',
    'new',
    'news',
    'newspaper',
    'next',
    'nibble',
    'nice',
    'nickel',
    'night',
    'nightgown',
    'nine',
    'nineteen',
    'ninety',
    'no',
    'nobody',
    'nod',
    'noise',
    'noisy',
    'none',
    'noon',
    'nor',
    'north',
    'northern',
    'nose',
    'not',
    'note',
    'nothing',
    'notice',
    'november',
    'now',
    'nowhere',
    'number',
    'nurse',
    'nut',
    'o',
    'oak',
    'oar',
    'oatmeal',
    'oats',
    'obey',
    'ocean',
    'october',
    'odd',
    'of',
    'off',
    'offer',
    'office',
    'officer',
    'often',
    'oh',
    'oil',
    'old',
    'on',
    'once',
    'one',
    'onion',
    'only',
    'onward',
    'open',
    'or',
    'orange',
    'orchard',
    'order',
    'ore',
    'organ',
    'other',
    'otherwise',
    'ouch',
    'ought',
    'our',
    'ours',
    'ourselves',
    'out',
    'outdoors',
    'outfit',
    'outlaw',
    'outline',
    'outside',
    'outward',
    'oven',
    'over',
    'overalls',
    'overcoat',
    'overeat',
    'overhead',
    'overhear',
    'overnight',
    'overturn',
    'owe',
    'owing',
    'owl',
    'own',
    'owner',
    'ox',
    'pa',
    'pace',
    'pack',
    'package',
    'pad',
    'page',
    'paid',
    'pail',
    'pain',
    'painful',
    'paint',
    'painter',
    'painting',
    'pair',
    'pal',
    'palace',
    'pale',
    'pan',
    'pancake',
    'pane',
    'pansy',
    'pants',
    'papa',
    'paper',
    'parade',
    'pardon',
    'parent',
    'park',
    'part',
    'partly',
    'partner',
    'party',
    'pass',
    'passenger',
    'past',
    'paste',
    'pasture',
    'pat',
    'patch',
    'path',
    'patter',
    'pave',
    'pavement',
    'paw',
    'pay',
    'payment',
    'pea',
    'peace',
    'peaceful',
    'peach',
    'peaches',
    'peak',
    'peanut',
    'pear',
    'pearl',
    'peas',
    'peck',
    'peek',
    'peel',
    'peep',
    'peg',
    'pen',
    'pencil',
    'penny',
    'people',
    'pepper',
    'peppermint',
    'perfume',
    'perhaps',
    'person',
    'pet',
    'phone',
    'piano',
    'pick',
    'pickle',
    'picnic',
    'picture',
    'pie',
    'piece',
    'pig',
    'pigeon',
    'piggy',
    'pile',
    'pill',
    'pillow',
    'pin',
    'pine',
    'pineapple',
    'pink',
    'pint',
    'pipe',
    'pistol',
    'pit',
    'pitch',
    'pitcher',
    'pity',
    'place',
    'plain',
    'plan',
    'plane',
    'plant',
    'plate',
    'platform',
    'platter',
    'play',
    'player',
    'playground',
    'playhouse',
    'playmate',
    'plaything',
    'pleasant',
    'please',
    'pleasure',
    'plenty',
    'plow',
    'plug',
    'plum',
    'pocket',
    'pocketbook',
    'poem',
    'point',
    'poison',
    'poke',
    'pole',
    'police',
    'policeman',
    'polish',
    'polite',
    'pond',
    'ponies',
    'pony',
    'pool',
    'poor',
    'pop',
    'popcorn',
    'popped',
    'porch',
    'pork',
    'possible',
    'post',
    'postage',
    'postman',
    'pot',
    'potato',
    'potatoes',
    'pound',
    'pour',
    'powder',
    'power',
    'powerful',
    'praise',
    'pray',
    'prayer',
    'prepare',
    'present',
    'pretty',
    'price',
    'prick',
    'prince',
    'princess',
    'print',
    'prison',
    'prize',
    'promise',
    'proper',
    'protect',
    'proud',
    'prove',
    'prune',
    'public',
    'puddle',
    'puff',
    'pull',
    'pump',
    'pumpkin',
    'punch',
    'punish',
    'pup',
    'pupil',
    'puppy',
    'pure',
    'purple',
    'purse',
    'push',
    'puss',
    'pussy',
    'pussycat',
    'put',
    'putting',
    'puzzle',
    'quack',
    'quart',
    'quarter',
    'queen',
    'queer',
    'question',
    'quick',
    'quickly',
    'quiet',
    'quilt',
    'quit',
    'quite',
    'rabbit',
    'race',
    'rack',
    'radio',
    'radish',
    'rag',
    'rail',
    'railroad',
    'railway',
    'rain',
    'rainbow',
    'rainy',
    'raise',
    'raisin',
    'rake',
    'ram',
    'ran',
    'ranch',
    'rang',
    'rap',
    'rapidly',
    'rat',
    'rate',
    'rather',
    'rattle',
    'raw',
    'ray',
    're',
    'reach',
    'read',
    'reader',
    'reading',
    'ready',
    'real',
    'really',
    'reap',
    'rear',
    'reason',
    'rebuild',
    'receive',
    'recess',
    'record',
    'red',
    'redbird',
    'redbreast',
    'refuse',
    'reindeer',
    'rejoice',
    'remain',
    'remember',
    'remind',
    'remove',
    'rent',
    'repair',
    'repay',
    'repeat',
    'report',
    'rest',
    'return',
    'review',
    'reward',
    'rib',
    'ribbon',
    'rice',
    'rich',
    'rid',
    'riddle',
    'ride',
    'rider',
    'riding',
    'right',
    'rim',
    'ring',
    'rip',
    'ripe',
    'rise',
    'rising',
    'river',
    'road',
    'roadside',
    'roar',
    'roast',
    'rob',
    'robber',
    'robe',
    'robin',
    'rock',
    'rocket',
    'rocky',
    'rode',
    'roll',
    'roller',
    'roof',
    'room',
    'rooster',
    'root',
    'rope',
    'rose',
    'rosebud',
    'rot',
    'rotten',
    'rough',
    'round',
    'route',
    'row',
    'rowboat',
    'royal',
    'rub',
    'rubbed',
    'rubber',
    'rubbish',
    'rug',
    'rule',
    'ruler',
    'rumble',
    'run',
    'rung',
    'runner',
    'running',
    'rush',
    'rust',
    'rusty',
    'rye',
    's',
    'sack',
    'sad',
    'saddle',
    'sadness',
    'safe',
    'safety',
    'said',
    'sail',
    'sailboat',
    'sailor',
    'saint',
    'salad',
    'sale',
    'salt',
    'same',
    'sand',
    'sandwich',
    'sandy',
    'sang',
    'sank',
    'sap',
    'sash',
    'sat',
    'satin',
    'satisfactory',
    'saturday',
    'sausage',
    'savage',
    'save',
    'savings',
    'saw',
    'say',
    'scab',
    'scales',
    'scare',
    'scarf',
    'school',
    'schoolboy',
    'schoolhouse',
    'schoolmaster',
    'schoolroom',
    'scorch',
    'score',
    'scrap',
    'scrape',
    'scratch',
    'scream',
    'screen',
    'screw',
    'scrub',
    'sea',
    'seal',
    'seam',
    'search',
    'season',
    'seat',
    'second',
    'secret',
    'see',
    'seed',
    'seeing',
    'seek',
    'seem',
    'seen',
    'seesaw',
    'select',
    'self',
    'selfish',
    'sell',
    'send',
    'sense',
    'sent',
    'sentence',
    'separate',
    'september',
    'servant',
    'serve',
    'service',
    'set',
    'setting',
    'settle',
    'settlement',
    'seven',
    'seventeen',
    'seventh',
    'seventy',
    'several',
    'sew',
    'shade',
    'shadow',
    'shady',
    'shake',
    'shaker',
    'shaking',
    'shall',
    'shame',
    'shan',
    'shape',
    'share',
    'sharp',
    'shave',
    'she',
    'shear',
    'shears',
    'shed',
    'sheep',
    'sheet',
    'shelf',
    'shell',
    'shepherd',
    'shine',
    'shining',
    'shiny',
    'ship',
    'shirt',
    'shock',
    'shoe',
    'shoemaker',
    'shone',
    'shook',
    'shoot',
    'shop',
    'shopping',
    'shore',
    'short',
    'shot',
    'should',
    'shoulder',
    'shouldn',
    'shout',
    'shovel',
    'show',
    'shower',
    'shut',
    'shy',
    'sick',
    'sickness',
    'side',
    'sidewalk',
    'sideways',
    'sigh',
    'sight',
    'sign',
    'silence',
    'silent',
    'silk',
    'sill',
    'silly',
    'silver',
    'simple',
    'sin',
    'since',
    'sing',
    'singer',
    'single',
    'sink',
    'sip',
    'sir',
    'sis',
    'sissy',
    'sister',
    'sit',
    'sitting',
    'six',
    'sixteen',
    'sixth',
    'sixty',
    'size',
    'skate',
    'skater',
    'ski',
    'skin',
    'skip',
    'skirt',
    'sky',
    'slam',
    'slap',
    'slate',
    'slave',
    'sled',
    'sleep',
    'sleepy',
    'sleeve',
    'sleigh',
    'slept',
    'slice',
    'slid',
    'slide',
    'sling',
    'slip',
    'slipped',
    'slipper',
    'slippery',
    'slit',
    'slow',
    'slowly',
    'sly',
    'smack',
    'small',
    'smart',
    'smell',
    'smile',
    'smoke',
    'smooth',
    'snail',
    'snake',
    'snap',
    'snapping',
    'sneeze',
    'snow',
    'snowball',
    'snowflake',
    'snowy',
    'snuff',
    'snug',
    'so',
    'soak',
    'soap',
    'sob',
    'socks',
    'sod',
    'soda',
    'sofa',
    'soft',
    'soil',
    'sold',
    'soldier',
    'sole',
    'some',
    'somebody',
    'somehow',
    'someone',
    'something',
    'sometime',
    'sometimes',
    'somewhere',
    'son',
    'song',
    'soon',
    'sore',
    'sorrow',
    'sorry',
    'sort',
    'soul',
    'sound',
    'soup',
    'sour',
    'south',
    'southern',
    'space',
    'spade',
    'spank',
    'sparrow',
    'speak',
    'speaker',
    'spear',
    'speech',
    'speed',
    'spell',
    'spelling',
    'spend',
    'spent',
    'spider',
    'spike',
    'spill',
    'spin',
    'spinach',
    'spirit',
    'spit',
    'splash',
    'spoil',
    'spoke',
    'spook',
    'spoon',
    'sport',
    'spot',
    'spread',
    'spring',
    'springtime',
    'sprinkle',
    'square',
    'squash',
    'squeak',
    'squeeze',
    'squirrel',
    'stable',
    'stack',
    'stage',
    'stair',
    'stall',
    'stamp',
    'stand',
    'star',
    'stare',
    'start',
    'starve',
    'state',
    'states',
    'station',
    'stay',
    'steak',
    'steal',
    'steam',
    'steamboat',
    'steamer',
    'steel',
    'steep',
    'steeple',
    'steer',
    'stem',
    'step',
    'stepping',
    'stick',
    'sticky',
    'stiff',
    'still',
    'stillness',
    'sting',
    'stir',
    'stitch',
    'stock',
    'stocking',
    'stole',
    'stone',
    'stood',
    'stool',
    'stoop',
    'stop',
    'stopped',
    'stopping',
    'store',
    'stories',
    'stork',
    'storm',
    'stormy',
    'story',
    'stove',
    'straight',
    'strange',
    'stranger',
    'strap',
    'straw',
    'strawberry',
    'stream',
    'street',
    'stretch',
    'string',
    'strip',
    'stripes',
    'strong',
    'stuck',
    'study',
    'stuff',
    'stump',
    'stung',
    'subject',
    'such',
    'suck',
    'sudden',
    'suffer',
    'sugar',
    'suit',
    'sum',
    'summer',
    'sun',
    'sunday',
    'sunflower',
    'sung',
    'sunk',
    'sunlight',
    'sunny',
    'sunrise',
    'sunset',
    'sunshine',
    'supper',
    'suppose',
    'sure',
    'surely',
    'surface',
    'surprise',
    'swallow',
    'swam',
    'swamp',
    'swan',
    'swat',
    'swear',
    'sweat',
    'sweater',
    'sweep',
    'sweet',
    'sweetheart',
    'sweetness',
    'swell',
    'swept',
    'swift',
    'swim',
    'swimming',
    'swing',
    'switch',
    'sword',
    'swore',
    't',
    'table',
    'tablecloth',
    'tablespoon',
    'tablet',
    'tack',
    'tag',
    'tail',
    'tailor',
    'take',
    'taken',
    'taking',
    'tale',
    'talk',
    'talker',
    'tall',
    'tame',
    'tan',
    'tank',
    'tap',
    'tape',
    'tar',
    'tardy',
    'task',
    'taste',
    'taught',
    'tax',
    'tea',
    'teach',
    'teacher',
    'team',
    'tear',
    'tease',
    'teaspoon',
    'teeth',
    'telephone',
    'tell',
    'temper',
    'ten',
    'tennis',
    'tent',
    'term',
    'terrible',
    'test',
    'than',
    'thank',
    'thankful',
    'thanks',
    'thanksgiving',
    'that',
    'the',
    'theater',
    'thee',
    'their',
    'them',
    'then',
    'there',
    'these',
    'they',
    'thick',
    'thief',
    'thimble',
    'thin',
    'thing',
    'think',
    'third',
    'thirsty',
    'thirteen',
    'thirty',
    'this',
    'thorn',
    'those',
    'though',
    'thought',
    'thousand',
    'thread',
    'three',
    'threw',
    'throat',
    'throne',
    'through',
    'throw',
    'thrown',
    'thumb',
    'thunder',
    'thursday',
    'thy',
    'tick',
    'ticket',
    'tickle',
    'tie',
    'tiger',
    'tight',
    'till',
    'time',
    'tin',
    'tinkle',
    'tiny',
    'tip',
    'tiptoe',
    'tire',
    'tired',
    'title',
    'to',
    'toad',
    'toadstool',
    'toast',
    'tobacco',
    'today',
    'toe',
    'together',
    'toilet',
    'told',
    'tomato',
    'tomorrow',
    'ton',
    'tone',
    'tongue',
    'tonight',
    'too',
    'took',
    'tool',
    'toot',
    'tooth',
    'toothbrush',
    'toothpick',
    'top',
    'tore',
    'torn',
    'toss',
    'touch',
    'tow',
    'toward',
    'towards',
    'towel',
    'tower',
    'town',
    'toy',
    'trace',
    'track',
    'trade',
    'train',
    'tramp',
    'trap',
    'tray',
    'treasure',
    'treat',
    'tree',
    'trick',
    'tricycle',
    'tried',
    'trim',
    'trip',
    'trolley',
    'trouble',
    'truck',
    'true',
    'truly',
    'trunk',
    'trust',
    'truth',
    'try',
    'tub',
    'tuesday',
    'tug',
    'tulip',
    'tumble',
    'tune',
    'tunnel',
    'turkey',
    'turn',
    'turtle',
    'twelve',
    'twenty',
    'twice',
    'twig',
    'twin',
    'two',
    'ugly',
    'umbrella',
    'uncle',
    'under',
    'understand',
    'underwear',
    'undress',
    'unfair',
    'unfinished',
    'unfold',
    'unfriendly',
    'unhappy',
    'unhurt',
    'uniform',
    'united',
    'unkind',
    'unknown',
    'unless',
    'unpleasant',
    'until',
    'unwilling',
    'up',
    'upon',
    'upper',
    'upset',
    'upside',
    'upstairs',
    'uptown',
    'upward',
    'us',
    'use',
    'used',
    'useful',
    'valentine',
    'valley',
    'valuable',
    'value',
    'vase',
    've',
    'vegetable',
    'velvet',
    'very',
    'vessel',
    'victory',
    'view',
    'village',
    'vine',
    'violet',
    'visit',
    'visitor',
    'voice',
    'vote',
    'wag',
    'wagon',
    'waist',
    'wait',
    'wake',
    'waken',
    'walk',
    'wall',
    'walnut',
    'want',
    'war',
    'warm',
    'warn',
    'was',
    'wash',
    'washer',
    'washtub',
    'wasn',
    'waste',
    'watch',
    'watchman',
    'water',
    'watermelon',
    'waterproof',
    'wave',
    'wax',
    'way',
    'wayside',
    'we',
    'weak',
    'weaken',
    'weakness',
    'wealth',
    'weapon',
    'wear',
    'weary',
    'weather',
    'weave',
    'web',
    'wedding',
    'wednesday',
    'wee',
    'weed',
    'week',
    'weep',
    'weigh',
    'welcome',
    'well',
    'went',
    'were',
    'west',
    'western',
    'wet',
    'whale',
    'what',
    'wheat',
    'wheel',
    'when',
    'whenever',
    'where',
    'which',
    'while',
    'whip',
    'whipped',
    'whirl',
    'whiskey',
    'whisky',
    'whisper',
    'whistle',
    'white',
    'who',
    'whole',
    'whom',
    'whose',
    'why',
    'wicked',
    'wide',
    'wife',
    'wiggle',
    'wild',
    'wildcat',
    'will',
    'willing',
    'willow',
    'win',
    'wind',
    'windmill',
    'window',
    'windy',
    'wine',
    'wing',
    'wink',
    'winner',
    'winter',
    'wipe',
    'wire',
    'wise',
    'wish',
    'wit',
    'witch',
    'with',
    'without',
    'woke',
    'wolf',
    'woman',
    'women',
    'won',
    'wonder',
    'wonderful',
    'wood',
    'wooden',
    'woodpecker',
    'woods',
    'wool',
    'woolen',
    'word',
    'wore',
    'work',
    'worker',
    'workman',
    'world',
    'worm',
    'worn',
    'worry',
    'worse',
    'worst',
    'worth',
    'would',
    'wouldn',
    'wound',
    'wove',
    'wow',
    'wrap',
    'wrapped',
    'wreck',
    'wren',
    'wring',
    'write',
    'writing',
    'written',
    'wrong',
    'wrote',
    'wrung',
    'yard',
    'yarn',
    'year',
    'yell',
    'yellow',
    'yes',
    'yesterday',
    'yet',
    'yolk',
    'yonder',
    'you',
    'young',
    'youngster',
    'your',
    'yours',
    'yourself',
    'yourselves',
    'youth'
]);

document.addEventListener('DOMContentLoaded', () => {
    const textInput = document.getElementById('textInput');
    const processButton = document.getElementById('processButton');
    const rsvpDisplay = document.getElementById('rsvpDisplay');
    const rsvpTextElement = document.getElementById('rsvpText');
    const wpmInput = document.getElementById('wpmInput');
    const estimatedTimeElement = document.getElementById('estimatedTime');

    // Configuration Constants
    const MAX_CHUNK_LENGTH = 19; // Less than 20 characters per chunk
    const DELAY_BETWEEN_LINES = 1000; // Extra milliseconds delay between lines
    const DEFAULT_WPM = 400;
    const MIN_WPM_LIMIT = 50;  // Sensible minimum WPM
    const MAX_WPM_LIMIT = 2000; // Sensible maximum WPM
    const WPM_STEP = 25;      // Increment/decrement value for WPM

    // State Variables
    let allProcessedLines = []; // Array of arrays (lines, then chunks within lines)
    let currentLineIndex = 0;
    let currentChunkIndex = 0;
    let isPlaying = false;
    let timerId = null;
    let wordsPerMinute = parseInt(wpmInput.value, 10) || DEFAULT_WPM;

    // --- Helper Functions ---

    function updateWPMValue(newPotentialWPM) {
        let targetWPM = parseInt(newPotentialWPM, 10);

        if (isNaN(targetWPM)) {
            // If parsing new value fails (e.g., from a cleared input field),
            // fall back to the current valid wordsPerMinute.
            targetWPM = wordsPerMinute;
        }

        const minWPM = parseInt(wpmInput.min, 10) || MIN_WPM_LIMIT;
        const maxWPM = parseInt(wpmInput.max, 10) || MAX_WPM_LIMIT;

        let clampedWPM = Math.max(minWPM, Math.min(targetWPM, maxWPM));

        // Only proceed if the clamped WPM is different from the current WPM,
        // OR if the input field's displayed text needs to be corrected to the clamped WPM.
        if (clampedWPM !== wordsPerMinute || String(wpmInput.value) !== String(clampedWPM)) {
            wordsPerMinute = clampedWPM;
            wpmInput.value = String(clampedWPM); // Update the input field text

            console.log("WPM set to:", wordsPerMinute); // Log the new speed
            updateEstimatedTime(); // Recalculate and display estimated time

            if (isPlaying) {
                stopReading();
                startReading(); // startReading will use the updated wordsPerMinute (via wpmInput.value)
            }
        }
    }


    function calculateDelayPerLetter() {
        if (wordsPerMinute <= 0) return 400; // Default if WPM is invalid
        const delayPerWord = (60 * 1000) / wordsPerMinute;

        // Assume 5 letters in a word plus a space
        return delayPerWord / 6;
    }

    function countTotalWords(text) {
        if (!text || text.trim() === "") return 0;
        return text.split(/\s+/).filter(word => word.length > 0).length;
    }

    function updateEstimatedTime() {
        const rawText = textInput.value;

        // Use the synchronized wordsPerMinute variable for calculation
        const currentWPM = wordsPerMinute;
        const totalWords = countTotalWords(rawText);

        if (totalWords === 0 || currentWPM <= 0) {
            estimatedTimeElement.textContent = "Estimated reading time: --";
            return;
        }

        const timeInMinutes = totalWords / currentWPM;
        const totalSeconds = Math.round(timeInMinutes * 60);

        if (totalSeconds === 0 && totalWords > 0) {
             estimatedTimeElement.textContent = "Estimated reading time: < 1 sec";
             return;
        }

        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;

        let timeString = "Estimated reading time: ";
        if (minutes > 0) {
            timeString += `${minutes} min `;
        }
        if (seconds > 0 || minutes === 0) {
            timeString += `${seconds} sec`;
        }
        estimatedTimeElement.textContent = timeString.trim();
    }

    function recommendReadingSpeed() {
        const rawText = textInput.value.trim();
        if (rawText.length < 100) {
            return;
        }

        const score = calculateFleschReadingEase(rawText);
        console.log(`Flesch Reading Ease score: ${score}`);

        // If 50 is the average score, increase reading speed when above average.
        const adjusted = 4.75 * score + 196;
        const recommended = Math.round(adjusted / 25) * 25;
        console.log(`Recommended reading speed: ${recommended} WPM`);
    }

    function chunkLine(line) {
        if (!line.trim()) return [];
        const words = line.split(/\s+/).filter(word => word.length > 0);
        const chunks = [];
        let currentChunk = "";
        for (const word of words) {
            if (currentChunk.length === 0) {
                currentChunk = word;
            } else if (currentChunk.length + 1 + word.length <= MAX_CHUNK_LENGTH) {
                currentChunk += " " + word;
            } else {
                chunks.push(currentChunk);
                currentChunk = word;
            }
        }
        if (currentChunk.length > 0) {
            chunks.push(currentChunk);
        }
        return chunks;
    }

    function processText() {
        const rawText = textInput.value;
        const lines = rawText.split('\n');
        allProcessedLines = lines.map(line => chunkLine(line)).filter(chunks => chunks.length > 0);
        currentLineIndex = 0;
        currentChunkIndex = 0;
        if (allProcessedLines.length > 0) {
            updateRsvpDisplay(allProcessedLines[0][0] || "[Start]");
            rsvpDisplay.classList.add('visible');
            container.classList.add("invisible");
        } else {
            updateRsvpDisplay("[No text processed]");
            rsvpDisplay.classList.remove('visible');
            container.classList.remove('invisible');
        }
        stopReading();
        updateEstimatedTime();
    }

    function updateRsvpDisplay(text) {
        rsvpTextElement.textContent = text;
    }

    function showCurrentPointer() {
        if (allProcessedLines.length === 0 || currentLineIndex >= allProcessedLines.length) {
            updateRsvpDisplay("[End of Text]");
            rsvpDisplay.classList.remove('visible');
            container.classList.remove('invisible');
            return;
        }
        const line = allProcessedLines[currentLineIndex];
        if (!line || currentChunkIndex >= line.length) {
            updateRsvpDisplay("[End of Line]"); // Should ideally not happen if logic is correct
            return;
        }
        updateRsvpDisplay(line[currentChunkIndex]);
        if (!rsvpDisplay.classList.contains('visible')) {
            rsvpDisplay.classList.add('visible');
        }
        if (!container.classList.contains('invisible')) {
            container.classList.add('invisible');
        }
    }

    function playNextChunk() {
        if (!isPlaying || allProcessedLines.length === 0) {
            stopReading();
            if(allProcessedLines.length === 0 && textInput.value.trim() !== "") processButton.click();
            else if (allProcessedLines.length === 0) updateRsvpDisplay("[Enter Text]");
            return;
        }

        if (currentLineIndex >= allProcessedLines.length) {
            updateRsvpDisplay("[End of Text]");
            stopReading();
            return;
        }

        const currentLine = allProcessedLines[currentLineIndex];
        if (currentChunkIndex >= currentLine.length) {
            currentLineIndex++;
            currentChunkIndex = 0;
            if (currentLineIndex >= allProcessedLines.length) {
                updateRsvpDisplay("[End of Text]");
                stopReading();
                return;
            }
            timerId = setTimeout(playNextChunk, DELAY_BETWEEN_LINES);
            return;
        }

        const chunk = currentLine[currentChunkIndex];
        updateRsvpDisplay(chunk);
        let weight = chunk.length;

        // Add extra time for punctuation.
        if (/[.?!]/.test(chunk)) weight += 5;
        if (/[,;:]/.test(chunk)) weight += 3;

        const words = chunk.match(/\b[a-zA-Z0-9]+\b/g) || [];
        for (const word of words) {
            const lowWord = word.toLowerCase();

            // Skip common words.
            if (daleChallWords.has(lowWord)) {
                continue;
            }

            // Add extra time for numbers proportional to length.
            if (/[0-9]/.test(word)) {
                weight += word.length;
            } else {
                // Add extra time for rare words and names proportional to syllable count.
                let wordWeight = countSyllables(word);

                // Add extra time for proper names.
                if (lowWord != word) {
                    wordWeight *= 2;
                }

                weight += wordWeight;
            }
        }

        let delay = weight * calculateDelayPerLetter();
        currentChunkIndex++;
        timerId = setTimeout(playNextChunk, delay);
    }

    function startReading() {
        if (isPlaying) return;
        if (allProcessedLines.length === 0) {
            processText();
            if (allProcessedLines.length === 0) {
                 updateRsvpDisplay("[No text to read]");
                 setTimeout(() => {
                     if (!isPlaying) {
                         rsvpDisplay.classList.remove('visible');
                         container.classList.remove('invisible');
                     }
                 }, 1500);
                 return;
            }
        }
        isPlaying = true;
        rsvpDisplay.classList.add('visible');
        container.classList.add('invisible');

        // Ensure wordsPerMinute is current, reading from the input (which updateWPMValue keeps synced)
        wordsPerMinute = parseInt(wpmInput.value, 10) || DEFAULT_WPM;
        playNextChunk();
    }

    function stopReading() {
        isPlaying = false;
        if (timerId) {
            clearTimeout(timerId);
            timerId = null;
        }
        const percentDone = currentLineIndex / allProcessedLines.length * 100;
        console.log(percentDone.toFixed(1) + "% done");
    }

    function togglePlayPause() {
        if (isPlaying) {
            stopReading();
        } else {
            startReading();
        }
    }

    function navigateBackward() { // Go to start of current line, or start of previous line
        stopReading();
        if (allProcessedLines.length === 0) return;

        if (currentChunkIndex > 0) { // If not at the start of a line
            currentChunkIndex = 0;    // Go to start of current line
        } else if (currentLineIndex > 0) { // If at start of a line, and not the first line
            currentLineIndex--;         // Go to previous line
            currentChunkIndex = 0;    // At its start
        } else { // At start of first line
            currentChunkIndex = 0;
        }
        showCurrentPointer();
    }

    function navigateForward() { // Go to start of next line
        stopReading();
        if (allProcessedLines.length === 0) return;

        if (currentLineIndex < allProcessedLines.length - 1) {
            currentLineIndex++;
            currentChunkIndex = 0;
        } else { // On the last line, go to its end or stay at start if already there
            const currentFullLine = allProcessedLines[currentLineIndex];
            currentChunkIndex = currentFullLine.length > 0 ? currentFullLine.length -1 : 0;
        }
        showCurrentPointer();
    }

    // --- Event Listeners ---
    processButton.addEventListener('click', () => {
        processText();
        startReading();
    });

    textInput.addEventListener('input', () => {
        updateEstimatedTime();
        recommendReadingSpeed();
    });

    wpmInput.addEventListener('change', () => {
        // Let updateWPMValue handle parsing, clamping, and side effects
        updateWPMValue(parseInt(wpmInput.value, 10));
    });

    document.addEventListener('keydown', (event) => {
        const activeElement = document.activeElement;
        const isInputFocused = activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA';

        if (event.key === ' ') {
            if (!isInputFocused || rsvpDisplay.classList.contains('visible')) {
                 event.preventDefault();
                 togglePlayPause();
            }
        } else if (event.key === 'ArrowLeft') {
             if (!isInputFocused || rsvpDisplay.classList.contains('visible')) {
                event.preventDefault();
                navigateBackward();
            }
        } else if (event.key === 'ArrowRight') {
             if (!isInputFocused || rsvpDisplay.classList.contains('visible')) {
                event.preventDefault();
                navigateForward();
            }
        } else if (event.key === 'ArrowUp') { // New feature: Increase WPM
            if (!isInputFocused || rsvpDisplay.classList.contains('visible')) {
                event.preventDefault();
                updateWPMValue(wordsPerMinute + WPM_STEP);
            }
        } else if (event.key === 'ArrowDown') { // New feature: Decrease WPM
            if (!isInputFocused || rsvpDisplay.classList.contains('visible')) {
                event.preventDefault();
                updateWPMValue(wordsPerMinute - WPM_STEP);
            }
        } else if (event.key === 'Escape') {
            if (rsvpDisplay.classList.contains('visible')) {
                event.preventDefault();
                stopReading();
                rsvpDisplay.classList.remove('visible');
                container.classList.remove('invisible');
            }
        }
    });

    // Helper function to count syllables in a word
    function countSyllables(word) {
        word = word.toLowerCase();
        if (word.length <= 3) return 1;
        word = word.replace(/(?:[^laeiouy]es|ed|[^laeiouy]e)$/, '');
        word = word.replace(/^y/, '');
        const syllableMatches = word.match(/[aeiouy]{1,2}/g);
        return syllableMatches ? syllableMatches.length : 1;
    }


    function calculateFleschReadingEase(text) {
        // Split text into sentences
        const sentences = text.split(/[.!?]+/).filter(Boolean);
        const totalSentences = sentences.length || 1;

        // Split text into words
        const words = text.match(/\b\w+\b/g) || [];
        const totalWords = words.length || 1;

        // Count total syllables
        let totalSyllables = 0;
        for (const word of words) {
            totalSyllables += countSyllables(word);
        }

        // Calculate FRE score
        const freScore =
            206.835 -
            1.015 * (totalWords / totalSentences) -
            84.6 * (totalSyllables / totalWords);

        return freScore.toFixed(2);
    }

    // --- Initial Setup ---
    updateRsvpDisplay("[Enter text and press 'Prepare Text' or Space]");
    // Sanitize initial WPM value from input and sync input field display
    updateWPMValue(wordsPerMinute); // This will clamp if needed and update dependent states
    // Initial call to estimate time based on current (possibly clamped) WPM
    updateEstimatedTime();
});
